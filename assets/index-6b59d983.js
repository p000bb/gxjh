/* empty css             */import{E}from"./el-button-4e36e058.js";import{E as S}from"./el-input-7ff3e30e.js";import j from"./videoCropper-95776fe5.js";import{d as D,t as L,ar as R,ax as B,r as w,o as z,J as N,y as c,A as d,k as r,K as f,C as T,E as u,B as m,ag as p,at as q,au as M,ap as O}from"./viewer-a917d3a0.js";import{a as W,u as A,b as G}from"./index-935e8e0f.js";import{W as H,G as _}from"./user-89041d09.js";import"./use-form-item-a4463e9d.js";import"./use-form-common-props-ac54b10b.js";import"./index-cb7b6eb7.js";import"./error-f1912ce6.js";/* empty css                   */import"./el-overlay-1dc85f1f.js";import"./index-31848957.js";import"./scroll-77ba8cf1.js";import"./vnode-37301cb0.js";import"./focus-trap-c1ca97d6.js";import"./refs-3c71427a.js";import"./el-tab-pane-70e51e74.js";import"./strings-1de25abc.js";import"./index-8a931359.js";import"./el-input-number-f0790d3e.js";import"./index-ee860d2d.js";import"./el-tooltip-4ed993c7.js";import"./el-popper-bf9c0fd5.js";import"./debounce-81d01b88.js";import"./index-0414d5d6.js";import"./directive-39134a76.js";const J=l=>(q("data-v-680a931e"),l=l(),M(),l),K={class:"box"},P={key:0,class:"input-div"},Q=J(()=>u("span",null,"视频名称：",-1)),X=["src"],Y={key:2,class:"look_img cursor-zoom-in"},Z=["src"],$={class:"btns"},ee=D({__name:"index",setup(l){const h=L(),b=R(),e=B({videoUrl:"",file:{},comIsShow:!1,name:"",type:"",id:""}),n=w(""),i=w({}),x=t=>{let o=t.target.files[0];o&&(e.videoUrl=URL.createObjectURL(o),e.file=o,e.name||(e.name=o.name),e.type=o.type,U(o))},U=t=>{let o=document.createElement("video");o.src=URL.createObjectURL(t),o.onloadedmetadata=function(){o.currentTime=1,o.onseeked=function(){let a=document.createElement("canvas");a.width=o.videoWidth,a.height=o.videoHeight,a.getContext("2d").drawImage(o,0,0,a.width,a.height);let s=document.createElement("img");s.src=a.toDataURL("image/jpeg"),n.value=s.src,a.toBlob(v=>{i.value=new File([v],"cover.jpeg",{type:"image/jpeg"})})}}},g=async t=>Promise.resolve(H.get(t,{responseType:"blob"}).then(o=>{let a=o.data.type.split("/")[1];return new File([o.data],e.name+"."+a,{type:o.data.type})})),k=()=>{e.comIsShow=!0},C=()=>{e.comIsShow=!1},I=t=>{n.value=t.url,i.value=new File([t.blob],"cover.jpeg",{type:t.blob.type})},F=async()=>{if(!e.name){_.error("请填写视频名称");return}if(!e.file){_.error("请选择视频文件");return}if(e.id){const t=new FormData;t.append("id",e.id),t.append("name",e.name),t.append("file",e.file),i.value&&t.append("coverFile",i.value),await A(t)}else{const t=new FormData;t.append("name",e.name),t.append("file",e.file),i.value&&t.append("coverFile",i.value),await G(t)}_.success("操作成功"),y()},y=()=>{b.push({path:"/file/video"})};return z(()=>{h.query.id&&W(h.query.id).then(async t=>{e.videoUrl="https://120.27.223.237/gxjh-file/"+t.data.path,e.name=t.data.name,e.id=t.data.id,n.value="https://120.27.223.237/gxjh-file/"+t.data.cover,i.value=await g(n.value),e.file=await g(e.videoUrl)})}),(t,o)=>{const a=S,s=E,v=N("viewer");return c(),d("div",K,[e.videoUrl?(c(),d("div",P,[Q,r(a,{modelValue:e.name,"onUpdate:modelValue":o[0]||(o[0]=V=>e.name=V),class:"input-name"},null,8,["modelValue"])])):f("",!0),e.videoUrl?(c(),d("video",{key:1,class:"videos",controls:"",src:e.videoUrl},null,8,X)):f("",!0),n.value?T((c(),d("div",Y,[u("img",{src:n.value,alt:""},null,8,Z)])),[[v]]):f("",!0),u("div",$,[r(s,{size:"large",class:"button"},{default:m(()=>[p(" 选择视频文件 "),u("input",{type:"file",id:"video-file",accept:"video/*",onChange:x},null,32)]),_:1}),r(s,{size:"large",color:"#fe3355",onClick:k},{default:m(()=>[p(" 提取封面 ")]),_:1}),r(s,{size:"large",onClick:y},{default:m(()=>[p(" 关闭 ")]),_:1}),r(s,{size:"large",type:"primary",onClick:F},{default:m(()=>[p(" 保存 ")]),_:1})]),r(j,{isShow:e.comIsShow,file:e.file,onCloseDialog:C,onConfirmImg:I},null,8,["isShow","file"])])}}});const Ee=O(ee,[["__scopeId","data-v-680a931e"]]);export{Ee as default};
