import{L}from"./el-button-534f93ec.js";import{E as h}from"./el-overlay-56edc591.js";/* empty css                */import{d as x,f as T,n as P,o as R}from"./admin-d15e446e.js";import"./el-popper-5f9a363e.js";import{E as B}from"./el-tree-select-4038975f.js";import C from"./uploadImg-055f8445.js";import{u as F,a as N,b as q}from"./index-d8f03a14.js";import{g as M}from"./index-609ba817.js";import{a as S}from"./index-b7dce1f7.js";import{d as z,r as n,o as O,y as W,x as j,B as r,E as A,k as o,ay as g}from"./viewer-71a6cc7b.js";const G={class:"dialog-footer"},oe=z({__name:"dataDialog",emits:["getPageList"],setup(H,{expose:v,emit:_}){const y=_,d=n(),i=n(!1),p=n(),u=n(),e=n({}),I=n({name:[{required:!0,message:"请输入名称",trigger:"change"}],categoryId:[{required:!0,message:"请选择文件种类",trigger:"change"}],imageUrl:[{required:!0,message:"请上传图片",trigger:"change"}]}),U=()=>{i.value=!1},V=()=>{var t;(t=p.value)==null||t.validate(async l=>{var m;if(l){if(e.value.id){const a=new FormData;a.append("id",e.value.id),a.append("name",e.value.name),a.append("categoryId",e.value.categoryId),(m=u.value)!=null&&m.fileList.length&&a.append("file",u.value.fileList[0].raw),await F(a)}else{const a=new FormData;a.append("name",e.value.name),a.append("file",u.value.fileList[0].raw),a.append("categoryId",e.value.categoryId),await N(a)}i.value=!1,x.success("操作成功"),y("getPageList")}})},E=async t=>{if(t!=null&&t.id){const l=await q(t.id);e.value={...l.data,imageUrl:{}.VITE_PREVIEW_URL+l.data.path},d.value="修改图片",i.value=!0}else e.value={categoryId:t.categoryId},d.value="新增图片",i.value=!0},c=n([]),w=async()=>{const t=await M({pageNum:1,pageSize:1e3});c.value=S([...t.data.list])||[]};return O(()=>{w()}),v({openDialog:E}),(t,l)=>{const m=T,a=P,k=B,b=R,f=L,D=h;return W(),j(D,{title:d.value,modelValue:i.value,"onUpdate:modelValue":l[3]||(l[3]=s=>i.value=s),width:"40%","close-on-click-modal":!1,"destroy-on-close":""},{footer:r(()=>[A("div",G,[o(f,{onClick:U},{default:r(()=>[g("取 消")]),_:1}),o(f,{type:"primary",onClick:V},{default:r(()=>[g("保 存")]),_:1})])]),default:r(()=>[o(b,{ref_key:"formRef",ref:p,model:e.value,rules:I.value,"label-width":"auto"},{default:r(()=>[o(a,{label:"名称：",prop:"name"},{default:r(()=>[o(m,{modelValue:e.value.name,"onUpdate:modelValue":l[0]||(l[0]=s=>e.value.name=s),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),o(a,{label:"文件种类：",prop:"categoryId"},{default:r(()=>[o(k,{modelValue:e.value.categoryId,"onUpdate:modelValue":l[1]||(l[1]=s=>e.value.categoryId=s),data:c.value,props:{value:"id",label:"name",children:"children"},"value-key":"id",placeholder:"选择文件种类","check-strictly":"",filterable:"","render-after-expand":!1,class:"w-full"},null,8,["modelValue","data"])]),_:1}),o(a,{label:"图片上传：",prop:"imageUrl"},{default:r(()=>[o(C,{imageUrl:e.value.imageUrl,"onUpdate:imageUrl":l[2]||(l[2]=s=>e.value.imageUrl=s),ref_key:"uploadRef",ref:u},null,8,["imageUrl"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}});export{oe as _};
