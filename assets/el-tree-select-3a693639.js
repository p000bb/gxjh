import{y as qe,z as de,A as he,B as Ke,q as Pe,U as ae,D as Fe}from"./admin-a54a04d3.js";import{a_ as ue,ap as _,aI as je,d as H,i as j,h as Y,ao as Q,r as w,b0 as Ve,w as x,au as V,b$ as He,v as M,C as fe,D as pe,y as S,A as P,E as ye,x as q,B as ie,aw as Re,M as A,aG as B,K as W,k as le,ax as Ue,F as we,aQ as Se,g as ve,al as xe,an as Ge,s as Ee,o as Ae,as as We,ak as Ye,b as T,G as Qe,az as Je,aq as Oe}from"./viewer-de354506.js";import{_ as Xe}from"./index-708bcd0b.js";import{_ as se,k as R,G as ce,D as Ze,E as _e,t as et,B as tt,m as nt}from"./el-button-ce4d76f3.js";import{E as L}from"./el-popper-a78eaae7.js";const F="$treeNodeId",De=function(e,t){!t||t[F]||Object.defineProperty(t,F,{value:e.id,enumerable:!1,configurable:!1,writable:!1})},me=function(e,t){return e?t[e]:t[F]},ge=(e,t,o)=>{const d=e.value.currentNode;o();const n=e.value.currentNode;d!==n&&t("current-change",n?n.data:null,n)},Ne=e=>{let t=!0,o=!0,d=!0;for(let n=0,s=e.length;n<s;n++){const a=e[n];(a.checked!==!0||a.indeterminate)&&(t=!1,a.disabled||(d=!1)),(a.checked!==!1||a.indeterminate)&&(o=!1)}return{all:t,none:o,allWithoutDisable:d,half:!t&&!o}},ee=function(e){if(e.childNodes.length===0||e.loading)return;const{all:t,none:o,half:d}=Ne(e.childNodes);t?(e.checked=!0,e.indeterminate=!1):d?(e.checked=!1,e.indeterminate=!0):o&&(e.checked=!1,e.indeterminate=!1);const n=e.parent;!n||n.level===0||e.store.checkStrictly||ee(n)},Z=function(e,t){const o=e.store.props,d=e.data||{},n=o[t];if(typeof n=="function")return n(d,e);if(typeof n=="string")return d[n];if(typeof n>"u"){const s=d[t];return s===void 0?"":s}};let ot=0;class I{constructor(t){this.id=ot++,this.text=null,this.checked=!1,this.indeterminate=!1,this.data=null,this.expanded=!1,this.parent=null,this.visible=!0,this.isCurrent=!1,this.canFocus=!1;for(const o in t)ue(t,o)&&(this[o]=t[o]);this.level=0,this.loaded=!1,this.childNodes=[],this.loading=!1,this.parent&&(this.level=this.parent.level+1)}initialize(){const t=this.store;if(!t)throw new Error("[Node]store is required!");t.registerNode(this);const o=t.props;if(o&&typeof o.isLeaf<"u"){const s=Z(this,"isLeaf");typeof s=="boolean"&&(this.isLeafByUser=s)}if(t.lazy!==!0&&this.data?(this.setData(this.data),t.defaultExpandAll&&(this.expanded=!0,this.canFocus=!0)):this.level>0&&t.lazy&&t.defaultExpandAll&&this.expand(),Array.isArray(this.data)||De(this,this.data),!this.data)return;const d=t.defaultExpandedKeys,n=t.key;n&&d&&d.includes(this.key)&&this.expand(null,t.autoExpandParent),n&&t.currentNodeKey!==void 0&&this.key===t.currentNodeKey&&(t.currentNode=this,t.currentNode.isCurrent=!0),t.lazy&&t._initDefaultCheckedNode(this),this.updateLeafState(),this.parent&&(this.level===1||this.parent.expanded===!0)&&(this.canFocus=!0)}setData(t){Array.isArray(t)||De(this,t),this.data=t,this.childNodes=[];let o;this.level===0&&Array.isArray(this.data)?o=this.data:o=Z(this,"children")||[];for(let d=0,n=o.length;d<n;d++)this.insertChild({data:o[d]})}get label(){return Z(this,"label")}get key(){const t=this.store.key;return this.data?this.data[t]:null}get disabled(){return Z(this,"disabled")}get nextSibling(){const t=this.parent;if(t){const o=t.childNodes.indexOf(this);if(o>-1)return t.childNodes[o+1]}return null}get previousSibling(){const t=this.parent;if(t){const o=t.childNodes.indexOf(this);if(o>-1)return o>0?t.childNodes[o-1]:null}return null}contains(t,o=!0){return(this.childNodes||[]).some(d=>d===t||o&&d.contains(t))}remove(){const t=this.parent;t&&t.removeChild(this)}insertChild(t,o,d){if(!t)throw new Error("InsertChild error: child is required.");if(!(t instanceof I)){if(!d){const n=this.getChildren(!0);n.includes(t.data)||(typeof o>"u"||o<0?n.push(t.data):n.splice(o,0,t.data))}Object.assign(t,{parent:this,store:this.store}),t=_(new I(t)),t instanceof I&&t.initialize()}t.level=this.level+1,typeof o>"u"||o<0?this.childNodes.push(t):this.childNodes.splice(o,0,t),this.updateLeafState()}insertBefore(t,o){let d;o&&(d=this.childNodes.indexOf(o)),this.insertChild(t,d)}insertAfter(t,o){let d;o&&(d=this.childNodes.indexOf(o),d!==-1&&(d+=1)),this.insertChild(t,d)}removeChild(t){const o=this.getChildren()||[],d=o.indexOf(t.data);d>-1&&o.splice(d,1);const n=this.childNodes.indexOf(t);n>-1&&(this.store&&this.store.deregisterNode(t),t.parent=null,this.childNodes.splice(n,1)),this.updateLeafState()}removeChildByData(t){let o=null;for(let d=0;d<this.childNodes.length;d++)if(this.childNodes[d].data===t){o=this.childNodes[d];break}o&&this.removeChild(o)}expand(t,o){const d=()=>{if(o){let n=this.parent;for(;n.level>0;)n.expanded=!0,n=n.parent}this.expanded=!0,t&&t(),this.childNodes.forEach(n=>{n.canFocus=!0})};this.shouldLoadData()?this.loadData(n=>{Array.isArray(n)&&(this.checked?this.setChecked(!0,!0):this.store.checkStrictly||ee(this),d())}):d()}doCreateChildren(t,o={}){t.forEach(d=>{this.insertChild(Object.assign({data:d},o),void 0,!0)})}collapse(){this.expanded=!1,this.childNodes.forEach(t=>{t.canFocus=!1})}shouldLoadData(){return this.store.lazy===!0&&this.store.load&&!this.loaded}updateLeafState(){if(this.store.lazy===!0&&this.loaded!==!0&&typeof this.isLeafByUser<"u"){this.isLeaf=this.isLeafByUser;return}const t=this.childNodes;if(!this.store.lazy||this.store.lazy===!0&&this.loaded===!0){this.isLeaf=!t||t.length===0;return}this.isLeaf=!1}setChecked(t,o,d,n){if(this.indeterminate=t==="half",this.checked=t===!0,this.store.checkStrictly)return;if(!(this.shouldLoadData()&&!this.store.checkDescendants)){const{all:a,allWithoutDisable:i}=Ne(this.childNodes);!this.isLeaf&&!a&&i&&(this.checked=!1,t=!1);const c=()=>{if(o){const N=this.childNodes;for(let r=0,l=N.length;r<l;r++){const f=N[r];n=n||t!==!1;const g=f.disabled?f.checked:n;f.setChecked(g,o,!0,n)}const{half:p,all:u}=Ne(N);u||(this.checked=u,this.indeterminate=p)}};if(this.shouldLoadData()){this.loadData(()=>{c(),ee(this)},{checked:t!==!1});return}else c()}const s=this.parent;!s||s.level===0||d||ee(s)}getChildren(t=!1){if(this.level===0)return this.data;const o=this.data;if(!o)return null;const d=this.store.props;let n="children";return d&&(n=d.children||"children"),o[n]===void 0&&(o[n]=null),t&&!o[n]&&(o[n]=[]),o[n]}updateChildren(){const t=this.getChildren()||[],o=this.childNodes.map(s=>s.data),d={},n=[];t.forEach((s,a)=>{const i=s[F];!!i&&o.findIndex(N=>N[F]===i)>=0?d[i]={index:a,data:s}:n.push({index:a,data:s})}),this.store.lazy||o.forEach(s=>{d[s[F]]||this.removeChildByData(s)}),n.forEach(({index:s,data:a})=>{this.insertChild({data:a},s)}),this.updateLeafState()}loadData(t,o={}){if(this.store.lazy===!0&&this.store.load&&!this.loaded&&(!this.loading||Object.keys(o).length)){this.loading=!0;const d=n=>{this.childNodes=[],this.doCreateChildren(n,o),this.loaded=!0,this.loading=!1,this.updateLeafState(),t&&t.call(this,n)};this.store.load(this,d)}else t&&t.call(this)}}class dt{constructor(t){this.currentNode=null,this.currentNodeKey=null;for(const o in t)ue(t,o)&&(this[o]=t[o]);this.nodesMap={}}initialize(){if(this.root=new I({data:this.data,store:this}),this.root.initialize(),this.lazy&&this.load){const t=this.load;t(this.root,o=>{this.root.doCreateChildren(o),this._initDefaultCheckedNodes()})}else this._initDefaultCheckedNodes()}filter(t){const o=this.filterNodeMethod,d=this.lazy,n=function(s){const a=s.root?s.root.childNodes:s.childNodes;if(a.forEach(i=>{i.visible=o.call(i,t,i.data,i),n(i)}),!s.visible&&a.length){let i=!0;i=!a.some(c=>c.visible),s.root?s.root.visible=i===!1:s.visible=i===!1}t&&s.visible&&!s.isLeaf&&!d&&s.expand()};n(this)}setData(t){t!==this.root.data?(this.root.setData(t),this._initDefaultCheckedNodes()):this.root.updateChildren()}getNode(t){if(t instanceof I)return t;const o=je(t)?me(this.key,t):t;return this.nodesMap[o]||null}insertBefore(t,o){const d=this.getNode(o);d.parent.insertBefore({data:t},d)}insertAfter(t,o){const d=this.getNode(o);d.parent.insertAfter({data:t},d)}remove(t){const o=this.getNode(t);o&&o.parent&&(o===this.currentNode&&(this.currentNode=null),o.parent.removeChild(o))}append(t,o){const d=o?this.getNode(o):this.root;d&&d.insertChild({data:t})}_initDefaultCheckedNodes(){const t=this.defaultCheckedKeys||[],o=this.nodesMap;t.forEach(d=>{const n=o[d];n&&n.setChecked(!0,!this.checkStrictly)})}_initDefaultCheckedNode(t){(this.defaultCheckedKeys||[]).includes(t.key)&&t.setChecked(!0,!this.checkStrictly)}setDefaultCheckedKey(t){t!==this.defaultCheckedKeys&&(this.defaultCheckedKeys=t,this._initDefaultCheckedNodes())}registerNode(t){const o=this.key;!t||!t.data||(o?t.key!==void 0&&(this.nodesMap[t.key]=t):this.nodesMap[t.id]=t)}deregisterNode(t){!this.key||!t||!t.data||(t.childNodes.forEach(d=>{this.deregisterNode(d)}),delete this.nodesMap[t.key])}getCheckedNodes(t=!1,o=!1){const d=[],n=function(s){(s.root?s.root.childNodes:s.childNodes).forEach(i=>{(i.checked||o&&i.indeterminate)&&(!t||t&&i.isLeaf)&&d.push(i.data),n(i)})};return n(this),d}getCheckedKeys(t=!1){return this.getCheckedNodes(t).map(o=>(o||{})[this.key])}getHalfCheckedNodes(){const t=[],o=function(d){(d.root?d.root.childNodes:d.childNodes).forEach(s=>{s.indeterminate&&t.push(s.data),o(s)})};return o(this),t}getHalfCheckedKeys(){return this.getHalfCheckedNodes().map(t=>(t||{})[this.key])}_getAllNodes(){const t=[],o=this.nodesMap;for(const d in o)ue(o,d)&&t.push(o[d]);return t}updateChildren(t,o){const d=this.nodesMap[t];if(!d)return;const n=d.childNodes;for(let s=n.length-1;s>=0;s--){const a=n[s];this.remove(a.data)}for(let s=0,a=o.length;s<a;s++){const i=o[s];this.append(i,d.data)}}_setCheckedKeys(t,o=!1,d){const n=this._getAllNodes().sort((i,c)=>c.level-i.level),s=Object.create(null),a=Object.keys(d);n.forEach(i=>i.setChecked(!1,!1));for(let i=0,c=n.length;i<c;i++){const N=n[i],p=N.data[t].toString();if(!a.includes(p)){N.checked&&!s[p]&&N.setChecked(!1,!1);continue}let r=N.parent;for(;r&&r.level>0;)s[r.data[t]]=!0,r=r.parent;if(N.isLeaf||this.checkStrictly){N.setChecked(!0,!1);continue}if(N.setChecked(!0,!0),o){N.setChecked(!1,!1);const l=function(f){f.childNodes.forEach(C=>{C.isLeaf||C.setChecked(!1,!1),l(C)})};l(N)}}}setCheckedNodes(t,o=!1){const d=this.key,n={};t.forEach(s=>{n[(s||{})[d]]=!0}),this._setCheckedKeys(d,o,n)}setCheckedKeys(t,o=!1){this.defaultCheckedKeys=t;const d=this.key,n={};t.forEach(s=>{n[s]=!0}),this._setCheckedKeys(d,o,n)}setDefaultExpandedKeys(t){t=t||[],this.defaultExpandedKeys=t,t.forEach(o=>{const d=this.getNode(o);d&&d.expand(null,this.autoExpandParent)})}setChecked(t,o,d){const n=this.getNode(t);n&&n.setChecked(!!o,d)}getCurrentNode(){return this.currentNode}setCurrentNode(t){const o=this.currentNode;o&&(o.isCurrent=!1),this.currentNode=t,this.currentNode.isCurrent=!0}setUserCurrentNode(t,o=!0){const d=t[this.key],n=this.nodesMap[d];this.setCurrentNode(n),o&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0)}setCurrentNodeKey(t,o=!0){if(t==null){this.currentNode&&(this.currentNode.isCurrent=!1),this.currentNode=null;return}const d=this.getNode(t);d&&(this.setCurrentNode(d),o&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0))}}const st=H({name:"ElTreeNodeContent",props:{node:{type:Object,required:!0},renderContent:Function},setup(e){const t=R("tree"),o=j("NodeInstance"),d=j("RootTree");return()=>{const n=e.node,{data:s,store:a}=n;return e.renderContent?e.renderContent(Y,{_self:o,node:n,data:s,store:a}):d.ctx.slots.default?d.ctx.slots.default({node:n,data:s}):Y("span",{class:t.be("node","label")},[n.label])}}});var rt=se(st,[["__file","/home/runner/work/element-plus/element-plus/packages/components/tree/src/tree-node-content.vue"]]);function Te(e){const t=j("TreeNodeMap",null),o={treeNodeExpand:d=>{e.node!==d&&e.node.collapse()},children:[]};return t&&t.children.push(o),Q("TreeNodeMap",o),{broadcastExpanded:d=>{if(e.accordion)for(const n of o.children)n.treeNodeExpand(d)}}}const Be=Symbol("dragEvents");function at({props:e,ctx:t,el$:o,dropIndicator$:d,store:n}){const s=R("tree"),a=w({showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0,dropType:null});return Q(Be,{treeNodeDragStart:({event:p,treeNode:u})=>{if(typeof e.allowDrag=="function"&&!e.allowDrag(u.node))return p.preventDefault(),!1;p.dataTransfer.effectAllowed="move";try{p.dataTransfer.setData("text/plain","")}catch{}a.value.draggingNode=u,t.emit("node-drag-start",u.node,p)},treeNodeDragOver:({event:p,treeNode:u})=>{const r=u,l=a.value.dropNode;l&&l.node.id!==r.node.id&&ce(l.$el,s.is("drop-inner"));const f=a.value.draggingNode;if(!f||!r)return;let g=!0,C=!0,m=!0,b=!0;typeof e.allowDrop=="function"&&(g=e.allowDrop(f.node,r.node,"prev"),b=C=e.allowDrop(f.node,r.node,"inner"),m=e.allowDrop(f.node,r.node,"next")),p.dataTransfer.dropEffect=C||g||m?"move":"none",(g||C||m)&&(l==null?void 0:l.node.id)!==r.node.id&&(l&&t.emit("node-drag-leave",f.node,l.node,p),t.emit("node-drag-enter",f.node,r.node,p)),(g||C||m)&&(a.value.dropNode=r),r.node.nextSibling===f.node&&(m=!1),r.node.previousSibling===f.node&&(g=!1),r.node.contains(f.node,!1)&&(C=!1),(f.node===r.node||f.node.contains(r.node))&&(g=!1,C=!1,m=!1);const D=r.$el.querySelector(`.${s.be("node","content")}`).getBoundingClientRect(),O=o.value.getBoundingClientRect();let v;const J=g?C?.25:m?.45:1:-1,X=m?C?.75:g?.55:0:1;let $=-9999;const y=p.clientY-D.top;y<D.height*J?v="before":y>D.height*X?v="after":C?v="inner":v="none";const K=r.$el.querySelector(`.${s.be("node","expand-icon")}`).getBoundingClientRect(),E=d.value;v==="before"?$=K.top-O.top:v==="after"&&($=K.bottom-O.top),E.style.top=`${$}px`,E.style.left=`${K.right-O.left}px`,v==="inner"?Ze(r.$el,s.is("drop-inner")):ce(r.$el,s.is("drop-inner")),a.value.showDropIndicator=v==="before"||v==="after",a.value.allowDrop=a.value.showDropIndicator||b,a.value.dropType=v,t.emit("node-drag-over",f.node,r.node,p)},treeNodeDragEnd:p=>{const{draggingNode:u,dropType:r,dropNode:l}=a.value;if(p.preventDefault(),p.dataTransfer.dropEffect="move",u&&l){const f={data:u.node.data};r!=="none"&&u.node.remove(),r==="before"?l.node.parent.insertBefore(f,l.node):r==="after"?l.node.parent.insertAfter(f,l.node):r==="inner"&&l.node.insertChild(f),r!=="none"&&n.value.registerNode(f),ce(l.$el,s.is("drop-inner")),t.emit("node-drag-end",u.node,l.node,r,p),r!=="none"&&t.emit("node-drop",u.node,l.node,r,p)}u&&!l&&t.emit("node-drag-end",u.node,null,r,p),a.value.showDropIndicator=!1,a.value.draggingNode=null,a.value.dropNode=null,a.value.allowDrop=!0}}),{dragState:a}}const it=H({name:"ElTreeNode",components:{ElCollapseTransition:Xe,ElCheckbox:qe,NodeContent:rt,ElIcon:_e,Loading:Ve},props:{node:{type:I,default:()=>({})},props:{type:Object,default:()=>({})},accordion:Boolean,renderContent:Function,renderAfterExpand:Boolean,showCheckbox:{type:Boolean,default:!1}},emits:["node-expand"],setup(e,t){const o=R("tree"),{broadcastExpanded:d}=Te(e),n=j("RootTree"),s=w(!1),a=w(!1),i=w(null),c=w(null),N=w(null),p=j(Be),u=ve();Q("NodeInstance",u),e.node.expanded&&(s.value=!0,a.value=!0);const r=n.props.props.children||"children";x(()=>{const y=e.node.data[r];return y&&[...y]},()=>{e.node.updateChildren()}),x(()=>e.node.indeterminate,y=>{g(e.node.checked,y)}),x(()=>e.node.checked,y=>{g(y,e.node.indeterminate)}),x(()=>e.node.expanded,y=>{V(()=>s.value=y),y&&(a.value=!0)});const l=y=>me(n.props.nodeKey,y.data),f=y=>{const K=e.props.class;if(!K)return{};let E;if(xe(K)){const{data:re}=y;E=K(re,y)}else E=K;return Ge(E)?{[E]:!0}:E},g=(y,K)=>{(i.value!==y||c.value!==K)&&n.ctx.emit("check-change",e.node.data,y,K),i.value=y,c.value=K},C=y=>{ge(n.store,n.ctx.emit,()=>n.store.value.setCurrentNode(e.node)),n.currentNode.value=e.node,n.props.expandOnClickNode&&b(),n.props.checkOnClickNode&&!e.node.disabled&&D(null,{target:{checked:!e.node.checked}}),n.ctx.emit("node-click",e.node.data,e.node,u,y)},m=y=>{n.instance.vnode.props.onNodeContextmenu&&(y.stopPropagation(),y.preventDefault()),n.ctx.emit("node-contextmenu",y,e.node.data,e.node,u)},b=()=>{e.node.isLeaf||(s.value?(n.ctx.emit("node-collapse",e.node.data,e.node,u),e.node.collapse()):(e.node.expand(),t.emit("node-expand",e.node.data,e.node,u)))},D=(y,K)=>{e.node.setChecked(K.target.checked,!n.props.checkStrictly),V(()=>{const E=n.store.value;n.ctx.emit("check",e.node.data,{checkedNodes:E.getCheckedNodes(),checkedKeys:E.getCheckedKeys(),halfCheckedNodes:E.getHalfCheckedNodes(),halfCheckedKeys:E.getHalfCheckedKeys()})})};return{ns:o,node$:N,tree:n,expanded:s,childNodeRendered:a,oldChecked:i,oldIndeterminate:c,getNodeKey:l,getNodeClass:f,handleSelectChange:g,handleClick:C,handleContextMenu:m,handleExpandIconClick:b,handleCheckChange:D,handleChildNodeExpand:(y,K,E)=>{d(K),n.ctx.emit("node-expand",y,K,E)},handleDragStart:y=>{n.props.draggable&&p.treeNodeDragStart({event:y,treeNode:e})},handleDragOver:y=>{y.preventDefault(),n.props.draggable&&p.treeNodeDragOver({event:y,treeNode:{$el:N.value,node:e.node}})},handleDrop:y=>{y.preventDefault()},handleDragEnd:y=>{n.props.draggable&&p.treeNodeDragEnd(y)},CaretRight:He}}}),lt=["aria-expanded","aria-disabled","aria-checked","draggable","data-key"],ct=["aria-expanded"];function ht(e,t,o,d,n,s){const a=M("el-icon"),i=M("el-checkbox"),c=M("loading"),N=M("node-content"),p=M("el-tree-node"),u=M("el-collapse-transition");return fe((S(),P("div",{ref:"node$",class:A([e.ns.b("node"),e.ns.is("expanded",e.expanded),e.ns.is("current",e.node.isCurrent),e.ns.is("hidden",!e.node.visible),e.ns.is("focusable",!e.node.disabled),e.ns.is("checked",!e.node.disabled&&e.node.checked),e.getNodeClass(e.node)]),role:"treeitem",tabindex:"-1","aria-expanded":e.expanded,"aria-disabled":e.node.disabled,"aria-checked":e.node.checked,draggable:e.tree.props.draggable,"data-key":e.getNodeKey(e.node),onClick:t[1]||(t[1]=B((...r)=>e.handleClick&&e.handleClick(...r),["stop"])),onContextmenu:t[2]||(t[2]=(...r)=>e.handleContextMenu&&e.handleContextMenu(...r)),onDragstart:t[3]||(t[3]=B((...r)=>e.handleDragStart&&e.handleDragStart(...r),["stop"])),onDragover:t[4]||(t[4]=B((...r)=>e.handleDragOver&&e.handleDragOver(...r),["stop"])),onDragend:t[5]||(t[5]=B((...r)=>e.handleDragEnd&&e.handleDragEnd(...r),["stop"])),onDrop:t[6]||(t[6]=B((...r)=>e.handleDrop&&e.handleDrop(...r),["stop"]))},[ye("div",{class:A(e.ns.be("node","content")),style:Ue({paddingLeft:(e.node.level-1)*e.tree.props.indent+"px"})},[e.tree.props.icon||e.CaretRight?(S(),q(a,{key:0,class:A([e.ns.be("node","expand-icon"),e.ns.is("leaf",e.node.isLeaf),{expanded:!e.node.isLeaf&&e.expanded}]),onClick:B(e.handleExpandIconClick,["stop"])},{default:ie(()=>[(S(),q(Re(e.tree.props.icon||e.CaretRight)))]),_:1},8,["class","onClick"])):W("v-if",!0),e.showCheckbox?(S(),q(i,{key:1,"model-value":e.node.checked,indeterminate:e.node.indeterminate,disabled:!!e.node.disabled,onClick:t[0]||(t[0]=B(()=>{},["stop"])),onChange:e.handleCheckChange},null,8,["model-value","indeterminate","disabled","onChange"])):W("v-if",!0),e.node.loading?(S(),q(a,{key:2,class:A([e.ns.be("node","loading-icon"),e.ns.is("loading")])},{default:ie(()=>[le(c)]),_:1},8,["class"])):W("v-if",!0),le(N,{node:e.node,"render-content":e.renderContent},null,8,["node","render-content"])],6),le(u,null,{default:ie(()=>[!e.renderAfterExpand||e.childNodeRendered?fe((S(),P("div",{key:0,class:A(e.ns.be("node","children")),role:"group","aria-expanded":e.expanded},[(S(!0),P(we,null,Se(e.node.childNodes,r=>(S(),q(p,{key:e.getNodeKey(r),"render-content":e.renderContent,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,node:r,accordion:e.accordion,props:e.props,onNodeExpand:e.handleChildNodeExpand},null,8,["render-content","render-after-expand","show-checkbox","node","accordion","props","onNodeExpand"]))),128))],10,ct)),[[pe,e.expanded]]):W("v-if",!0)]),_:1})],42,lt)),[[pe,e.node.visible]])}var ut=se(it,[["render",ht],["__file","/home/runner/work/element-plus/element-plus/packages/components/tree/src/tree-node.vue"]]);function ft({el$:e},t){const o=R("tree"),d=Ee([]),n=Ee([]);Ae(()=>{a()}),We(()=>{d.value=Array.from(e.value.querySelectorAll("[role=treeitem]")),n.value=Array.from(e.value.querySelectorAll("input[type=checkbox]"))}),x(n,i=>{i.forEach(c=>{c.setAttribute("tabindex","-1")})}),Ye(e,"keydown",i=>{const c=i.target;if(!c.className.includes(o.b("node")))return;const N=i.code;d.value=Array.from(e.value.querySelectorAll(`.${o.is("focusable")}[role=treeitem]`));const p=d.value.indexOf(c);let u;if([L.up,L.down].includes(N)){if(i.preventDefault(),N===L.up){u=p===-1?0:p!==0?p-1:d.value.length-1;const l=u;for(;!t.value.getNode(d.value[u].dataset.key).canFocus;){if(u--,u===l){u=-1;break}u<0&&(u=d.value.length-1)}}else{u=p===-1?0:p<d.value.length-1?p+1:0;const l=u;for(;!t.value.getNode(d.value[u].dataset.key).canFocus;){if(u++,u===l){u=-1;break}u>=d.value.length&&(u=0)}}u!==-1&&d.value[u].focus()}[L.left,L.right].includes(N)&&(i.preventDefault(),c.click());const r=c.querySelector('[type="checkbox"]');[L.enter,L.space].includes(N)&&r&&(i.preventDefault(),r.click())});const a=()=>{var i;d.value=Array.from(e.value.querySelectorAll(`.${o.is("focusable")}[role=treeitem]`)),n.value=Array.from(e.value.querySelectorAll("input[type=checkbox]"));const c=e.value.querySelectorAll(`.${o.is("checked")}[role=treeitem]`);if(c.length){c[0].setAttribute("tabindex","0");return}(i=d.value[0])==null||i.setAttribute("tabindex","0")}}const pt=H({name:"ElTree",components:{ElTreeNode:ut},props:{data:{type:Array,default:()=>[]},emptyText:{type:String},renderAfterExpand:{type:Boolean,default:!0},nodeKey:String,checkStrictly:Boolean,defaultExpandAll:Boolean,expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:Boolean,checkDescendants:{type:Boolean,default:!1},autoExpandParent:{type:Boolean,default:!0},defaultCheckedKeys:Array,defaultExpandedKeys:Array,currentNodeKey:[String,Number],renderContent:Function,showCheckbox:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},allowDrag:Function,allowDrop:Function,props:{type:Object,default:()=>({children:"children",label:"label",disabled:"disabled"})},lazy:{type:Boolean,default:!1},highlightCurrent:Boolean,load:Function,filterNodeMethod:Function,accordion:Boolean,indent:{type:Number,default:18},icon:{type:et}},emits:["check-change","current-change","node-click","node-contextmenu","node-collapse","node-expand","check","node-drag-start","node-drag-end","node-drop","node-drag-leave","node-drag-enter","node-drag-over"],setup(e,t){const{t:o}=tt(),d=R("tree"),n=w(new dt({key:e.nodeKey,data:e.data,lazy:e.lazy,props:e.props,load:e.load,currentNodeKey:e.currentNodeKey,checkStrictly:e.checkStrictly,checkDescendants:e.checkDescendants,defaultCheckedKeys:e.defaultCheckedKeys,defaultExpandedKeys:e.defaultExpandedKeys,autoExpandParent:e.autoExpandParent,defaultExpandAll:e.defaultExpandAll,filterNodeMethod:e.filterNodeMethod}));n.value.initialize();const s=w(n.value.root),a=w(null),i=w(null),c=w(null),{broadcastExpanded:N}=Te(e),{dragState:p}=at({props:e,ctx:t,el$:i,dropIndicator$:c,store:n});ft({el$:i},n);const u=T(()=>{const{childNodes:h}=s.value;return!h||h.length===0||h.every(({visible:k})=>!k)});x(()=>e.currentNodeKey,h=>{n.value.setCurrentNodeKey(h)}),x(()=>e.defaultCheckedKeys,h=>{n.value.setDefaultCheckedKey(h)}),x(()=>e.defaultExpandedKeys,h=>{n.value.setDefaultExpandedKeys(h)}),x(()=>e.data,h=>{n.value.setData(h)},{deep:!0}),x(()=>e.checkStrictly,h=>{n.value.checkStrictly=h});const r=h=>{if(!e.filterNodeMethod)throw new Error("[Tree] filterNodeMethod is required when filter");n.value.filter(h)},l=h=>me(e.nodeKey,h.data),f=h=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getNodePath");const k=n.value.getNode(h);if(!k)return[];const z=[k.data];let U=k.parent;for(;U&&U!==s.value;)z.push(U.data),U=U.parent;return z.reverse()},g=(h,k)=>n.value.getCheckedNodes(h,k),C=h=>n.value.getCheckedKeys(h),m=()=>{const h=n.value.getCurrentNode();return h?h.data:null},b=()=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getCurrentKey");const h=m();return h?h[e.nodeKey]:null},D=(h,k)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedNodes");n.value.setCheckedNodes(h,k)},O=(h,k)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedKeys");n.value.setCheckedKeys(h,k)},v=(h,k,z)=>{n.value.setChecked(h,k,z)},J=()=>n.value.getHalfCheckedNodes(),X=()=>n.value.getHalfCheckedKeys(),$=(h,k=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentNode");ge(n,t.emit,()=>n.value.setUserCurrentNode(h,k))},y=(h,k=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentKey");ge(n,t.emit,()=>n.value.setCurrentNodeKey(h,k))},K=h=>n.value.getNode(h),E=h=>{n.value.remove(h)},re=(h,k)=>{n.value.append(h,k)},Me=(h,k)=>{n.value.insertBefore(h,k)},Ie=(h,k)=>{n.value.insertAfter(h,k)},$e=(h,k,z)=>{N(k),t.emit("node-expand",h,k,z)},ze=(h,k)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in updateKeyChild");n.value.updateChildren(h,k)};return Q("RootTree",{ctx:t,props:e,store:n,root:s,currentNode:a,instance:ve()}),Q(nt,void 0),{ns:d,store:n,root:s,currentNode:a,dragState:p,el$:i,dropIndicator$:c,isEmpty:u,filter:r,getNodeKey:l,getNodePath:f,getCheckedNodes:g,getCheckedKeys:C,getCurrentNode:m,getCurrentKey:b,setCheckedNodes:D,setCheckedKeys:O,setChecked:v,getHalfCheckedNodes:J,getHalfCheckedKeys:X,setCurrentNode:$,setCurrentKey:y,t:o,getNode:K,remove:E,append:re,insertBefore:Me,insertAfter:Ie,handleNodeExpand:$e,updateKeyChildren:ze}}});function yt(e,t,o,d,n,s){const a=M("el-tree-node");return S(),P("div",{ref:"el$",class:A([e.ns.b(),e.ns.is("dragging",!!e.dragState.draggingNode),e.ns.is("drop-not-allow",!e.dragState.allowDrop),e.ns.is("drop-inner",e.dragState.dropType==="inner"),{[e.ns.m("highlight-current")]:e.highlightCurrent}]),role:"tree"},[(S(!0),P(we,null,Se(e.root.childNodes,i=>(S(),q(a,{key:e.getNodeKey(i),node:i,props:e.props,accordion:e.accordion,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,"render-content":e.renderContent,onNodeExpand:e.handleNodeExpand},null,8,["node","props","accordion","render-after-expand","show-checkbox","render-content","onNodeExpand"]))),128)),e.isEmpty?(S(),P("div",{key:0,class:A(e.ns.e("empty-block"))},[Qe(e.$slots,"empty",{},()=>{var i;return[ye("span",{class:A(e.ns.e("empty-text"))},Je((i=e.emptyText)!=null?i:e.t("el.tree.emptyText")),3)]})],2)):W("v-if",!0),fe(ye("div",{ref:"dropIndicator$",class:A(e.ns.e("drop-indicator"))},null,2),[[pe,e.dragState.showDropIndicator]])],2)}var te=se(pt,[["render",yt],["__file","/home/runner/work/element-plus/element-plus/packages/components/tree/src/tree.vue"]]);te.install=e=>{e.component(te.name,te)};const ke=te,gt=(e,{attrs:t},{tree:o,key:d})=>{const n=R("tree-select"),s={...de(Oe(e),Object.keys(he.props)),...t,valueKey:d,popperClass:T(()=>{const a=[n.e("popper")];return e.popperClass&&a.push(e.popperClass),a.join(" ")}),filterMethod:(a="")=>{e.filterMethod&&e.filterMethod(a),V(()=>{var i;(i=o.value)==null||i.filter(a)})},onVisibleChange:a=>{var i;(i=t.onVisibleChange)==null||i.call(t,a),e.filterable&&a&&s.filterMethod()}};return s},Nt=H({extends:Ke,setup(e,t){const o=Ke.setup(e,t);delete o.selectOptionClick;const d=ve().proxy;return V(()=>{o.select.cachedOptions.get(d.value)||o.select.onOptionCreate(d)}),o},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function Ce(e){return e||e===0}function be(e){return Array.isArray(e)&&e.length}function G(e){return Array.isArray(e)?e:Ce(e)?[e]:[]}function ne(e,t,o,d,n){for(let s=0;s<e.length;s++){const a=e[s];if(t(a,s,e,n))return d?d(a,s,e,n):a;{const i=o(a);if(be(i)){const c=ne(i,t,o,d,a);if(c)return c}}}}function Le(e,t,o,d){for(let n=0;n<e.length;n++){const s=e[n];t(s,n,e,d);const a=o(s);be(a)&&Le(a,t,o,s)}}const kt=(e,{attrs:t,slots:o,emit:d},{select:n,tree:s,key:a})=>{x(()=>e.modelValue,()=>{e.showCheckbox&&V(()=>{const r=s.value;r&&!Pe(r.getCheckedKeys(),G(e.modelValue))&&r.setCheckedKeys(G(e.modelValue))})},{immediate:!0,deep:!0});const i=T(()=>({value:a.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),c=(r,l)=>{var f;const g=i.value[r];return xe(g)?g(l,(f=s.value)==null?void 0:f.getNode(c("value",l))):l[g]},N=G(e.modelValue).map(r=>ne(e.data||[],l=>c("value",l)===r,l=>c("children",l),(l,f,g,C)=>C&&c("value",C))).filter(r=>Ce(r)),p=T(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const r=[];return Le(e.data.concat(e.cacheData),l=>{const f=c("value",l);r.push({value:f,currentLabel:c("label",l),isDisabled:c("disabled",l)})},l=>c("children",l)),r}),u=T(()=>p.value.reduce((r,l)=>({...r,[l.value]:l}),{}));return{...de(Oe(e),Object.keys(ke.props)),...t,nodeKey:a,expandOnClickNode:T(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:T(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(N):N),renderContent:(r,{node:l,data:f,store:g})=>r(Nt,{value:c("value",f),label:c("label",f),disabled:c("disabled",f)},e.renderContent?()=>e.renderContent(r,{node:l,data:f,store:g}):o.default?()=>o.default({node:l,data:f,store:g}):void 0),filterNodeMethod:(r,l,f)=>{var g;return e.filterNodeMethod?e.filterNodeMethod(r,l,f):r?(g=c("label",l))==null?void 0:g.includes(r):!0},onNodeClick:(r,l,f)=>{var g,C,m;if((g=t.onNodeClick)==null||g.call(t,r,l,f),!(e.showCheckbox&&e.checkOnClickNode))if(!e.showCheckbox&&(e.checkStrictly||l.isLeaf)){if(!c("disabled",r)){const b=(C=n.value)==null?void 0:C.options.get(c("value",r));(m=n.value)==null||m.handleOptionSelect(b)}}else e.expandOnClickNode&&f.proxy.handleExpandIconClick()},onCheck:(r,l)=>{if(!e.showCheckbox)return;const f=c("value",r),g=l.checkedKeys,C=e.multiple?G(e.modelValue).filter(b=>b in u.value&&!s.value.getNode(b)&&!g.includes(b)):[],m=g.concat(C);if(e.checkStrictly)d(ae,e.multiple?m:m.includes(f)?f:void 0);else if(e.multiple)d(ae,s.value.getCheckedKeys(!0));else{const b=ne([r],v=>!be(c("children",v))&&!c("disabled",v),v=>c("children",v)),D=b?c("value",b):void 0,O=Ce(e.modelValue)&&!!ne([r],v=>c("value",v)===e.modelValue,v=>c("children",v));d(ae,D===e.modelValue||O?void 0:D)}V(()=>{var b;const D=G(e.modelValue);s.value.setCheckedKeys(D),(b=t.onCheck)==null||b.call(t,r,{checkedKeys:s.value.getCheckedKeys(),checkedNodes:s.value.getCheckedNodes(),halfCheckedKeys:s.value.getHalfCheckedKeys(),halfCheckedNodes:s.value.getHalfCheckedNodes()})})},cacheOptions:p}};var Ct=H({props:{data:{type:Array,default:()=>[]}},setup(e){const t=j(Fe);return x(()=>e.data,()=>{var o;e.data.forEach(n=>{t.cachedOptions.has(n.value)||t.cachedOptions.set(n.value,n)});const d=((o=t.selectWrapper)==null?void 0:o.querySelectorAll("input"))||[];Array.from(d).includes(document.activeElement)||t.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const vt=H({name:"ElTreeSelect",inheritAttrs:!1,props:{...he.props,...ke.props,cacheData:{type:Array,default:()=>[]}},setup(e,t){const{slots:o,expose:d}=t,n=w(),s=w(),a=T(()=>e.nodeKey||e.valueKey||"value"),i=gt(e,t,{select:n,tree:s,key:a}),{cacheOptions:c,...N}=kt(e,t,{select:n,tree:s,key:a}),p=_({});return d(p),Ae(()=>{Object.assign(p,{...de(s.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...de(n.value,["focus","blur"])})}),()=>Y(he,_({...i,ref:u=>n.value=u}),{...o,default:()=>[Y(Ct,{data:c.value}),Y(ke,_({...N,ref:u=>s.value=u}))]})}});var oe=se(vt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/tree-select/src/tree-select.vue"]]);oe.install=e=>{e.component(oe.name,oe)};const mt=oe,St=mt;export{St as E};
