import{L as R}from"./el-button-534f93ec.js";import{v as F,d as _,f as L}from"./admin-d15e446e.js";import S from"./videoCropper-afb97923.js";import{d as D,t as j,b8 as B,ap as z,r as w,o as N,J as T,y as c,A as d,k as l,K as f,C as P,E as u,B as m,ay as p,b9 as W,ba as q,b6 as M}from"./viewer-71a6cc7b.js";import{a as O,u as A,b as H}from"./index-0df10c68.js";import"./el-popper-5f9a363e.js";import"./debounce-e240d589.js";/* empty css                   */import"./el-overlay-56edc591.js";import"./index-07157569.js";import"./vnode-d45677e0.js";import"./refs-45d3232c.js";import"./el-tab-pane-4dd720c9.js";import"./index-58ca3b32.js";import"./el-input-number-9046f3aa.js";import"./index-65fc4267.js";import"./el-tooltip-4ed993c7.js";import"./position-87c88502.js";import"./directive-44e37452.js";import"./service copy-fb1d097e.js";const J=r=>(W("data-v-680a931e"),r=r(),q(),r),K={class:"box"},G={key:0,class:"input-div"},Q=J(()=>u("span",null,"视频名称：",-1)),X=["src"],Y={key:2,class:"look_img cursor-zoom-in"},Z=["src"],$={class:"btns"},ee=D({__name:"index",setup(r){const g=j(),b=B(),e=z({videoUrl:"",file:{},comIsShow:!1,name:"",type:"",id:""}),n=w(""),i=w({}),U=t=>{let o=t.target.files[0];o&&(e.videoUrl=URL.createObjectURL(o),e.file=o,e.name||(e.name=o.name),e.type=o.type,I(o))},I=t=>{let o=document.createElement("video");o.src=URL.createObjectURL(t),o.onloadedmetadata=function(){o.currentTime=1,o.onseeked=function(){let a=document.createElement("canvas");a.width=o.videoWidth,a.height=o.videoHeight,a.getContext("2d").drawImage(o,0,0,a.width,a.height);let s=document.createElement("img");s.src=a.toDataURL("image/jpeg"),n.value=s.src,a.toBlob(v=>{i.value=new File([v],"cover.jpeg",{type:"image/jpeg"})})}}},h=async t=>Promise.resolve(F.get(t,{responseType:"blob"}).then(o=>{let a=o.data.type.split("/")[1];return new File([o.data],e.name+"."+a,{type:o.data.type})})),V=()=>{e.comIsShow=!0},k=()=>{e.comIsShow=!1},C=t=>{n.value=t.url,i.value=new File([t.blob],"cover.jpeg",{type:t.blob.type})},E=async()=>{if(!e.name){_.error("请填写视频名称");return}if(!e.file){_.error("请选择视频文件");return}if(e.id){const t=new FormData;t.append("id",e.id),t.append("name",e.name),t.append("file",e.file),i.value&&t.append("coverFile",i.value),await A(t)}else{const t=new FormData;t.append("name",e.name),t.append("file",e.file),i.value&&t.append("coverFile",i.value),await H(t)}_.success("操作成功"),y()},y=()=>{b.push({path:"/file/video"})};return N(()=>{g.query.id&&O(g.query.id).then(async t=>{e.videoUrl={}.VITE_PREVIEW_URL+t.data.path,e.name=t.data.name,e.id=t.data.id,n.value={}.VITE_PREVIEW_URL+t.data.cover,i.value=await h(n.value),e.file=await h(e.videoUrl)})}),(t,o)=>{const a=L,s=R,v=T("viewer");return c(),d("div",K,[e.videoUrl?(c(),d("div",G,[Q,l(a,{modelValue:e.name,"onUpdate:modelValue":o[0]||(o[0]=x=>e.name=x),class:"input-name"},null,8,["modelValue"])])):f("",!0),e.videoUrl?(c(),d("video",{key:1,class:"videos",controls:"",src:e.videoUrl},null,8,X)):f("",!0),n.value?P((c(),d("div",Y,[u("img",{src:n.value,alt:""},null,8,Z)])),[[v]]):f("",!0),u("div",$,[l(s,{size:"large",class:"button"},{default:m(()=>[p(" 选择视频文件 "),u("input",{type:"file",id:"video-file",accept:"video/*",onChange:U},null,32)]),_:1}),l(s,{size:"large",color:"#fe3355",onClick:V},{default:m(()=>[p(" 提取封面 ")]),_:1}),l(s,{size:"large",onClick:y},{default:m(()=>[p(" 关闭 ")]),_:1}),l(s,{size:"large",type:"primary",onClick:E},{default:m(()=>[p(" 保存 ")]),_:1})]),l(S,{isShow:e.comIsShow,file:e.file,onCloseDialog:k,onConfirmImg:C},null,8,["isShow","file"])])}}});const be=M(ee,[["__scopeId","data-v-680a931e"]]);export{be as default};
